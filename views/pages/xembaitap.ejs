<link rel="stylesheet" href="/css/xembaitap.css">

<div class="container">
    <h2>Xem Bài Tập</h2>

    <!-- Thống kê (chỉ để 1 lần) -->
    <div class="stats">
        <div class="card total"><h3><%= total %></h3><p>Tổng số bài tập</p></div>
        <div class="card active"><h3><%= active %></h3><p>Đang hoạt động</p></div>
        <div class="card expired"><h3><%= expired %></h3><p>Đã hết hạn</p></div>
    </div>

    <!-- BỘ LỌC – ĐÃ SỬA CLASS filter-btn + PENDING -->
    <div class="filter-controls" style="text-align:center; margin:20px 0; padding:15px; background:#f8f9fa; border-radius:12px;">
        <div class="filter-buttons" style="display:inline-block; margin:0 20px;">
            <button class="filter-btn active" data-filter="all">Tất cả</button>
            <button class="filter-btn" data-filter="active">Đang hoạt động</button>
            <button class="filter-btn" data-filter="expired">Đã hết hạn</button>
            <button class="filter-btn" data-filter="pending">Chưa giao</button>
        </div>

        <label for="subjectSelect" style="font-weight:600; margin-left:20px;">Lọc theo môn:</label>
        <select id="subjectSelect" style="padding:8px 12px; border-radius:8px; border:1px solid #3b82f6; font-size:14px;">
            <option value="all">Tất cả môn</option>
            <% 
                const subjects = [...new Set(assignments.map(a => a.subject))].sort();
                subjects.forEach(s => { 
            %>
                <option value="<%= s %>"><%= s %></option>
            <% }) %>
        </select>
    </div>

    <!-- Danh sách bài tập -->
    <div class="assignments-grid">
        <% assignments.forEach(a => { %>
            <div class="assignment <%= a.isEmpty ? 'empty-assignment' : (a.expired ? 'expired' : '') %>"
                 data-subject="<%= a.subject %>">
                 
                <div class="header">
                    <span class="subject"><%= a.subject %></span>
                    <% if (!a.isEmpty) { %>
                        <span class="status-badge <%= a.expired ? 'expired' : 'active' %>">
                            <%= a.expired ? 'Quá hạn' : `Còn ${a.remainingDays} ngày` %>
                        </span>
                    <% } %>
                </div>

                <h4 class="assignment-title"><%= a.title %></h4>

                <% if (!a.isEmpty) { %>
                    <div style="margin-top: 12px; font-size: 13.5px; line-height: 1.8;">
                        <div style="color: #475569;">
                            <strong style="color: #1e40af;">GV:</strong> <%= a.teacher %>
                        </div>
                        <div style="color: #dc2626; font-weight: 600; margin-top: 4px;">
                            Hạn nộp: <%= new Date(a.dueDate).toLocaleDateString('vi-VN') %>
                        </div>
                    </div>
                <% } else { %>
                    <p style="margin: 16px 0; color: #94a3b8; font-style: italic; text-align: center; font-size: 14px;">        
                    </p>
                <% } %>

                <div class="description" style="display:none;"><%- a.fullDescription %></div>
            </div>
        <% }) %>
    </div>
</div>

<!-- Modal -->
<div id="assignmentModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">×</span>
        <div class="modal-header">
            <h3 id="m_subject"></h3>
            <h4 id="m_title"></h4>
        </div>
        <div id="m_description" style="margin:20px 0; padding:15px; background:#f8fafc; border-radius:8px;"></div>
        <button class="close-modal-btn">Đóng</button>
    </div>
</div>

<script src="/js/xembaitap.js"></script>